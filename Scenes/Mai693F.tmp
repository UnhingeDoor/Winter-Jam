[gd_scene load_steps=7 format=3 uid="uid://rrl6e6temvop"]

[ext_resource type="PackedScene" uid="uid://cuxdvqwiaaatv" path="res://Scenes/Present.tscn" id="1_mb113"]
[ext_resource type="PackedScene" uid="uid://1x65lccosvku" path="res://Scenes/Player.tscn" id="2_uywyi"]
[ext_resource type="Script" path="res://Scripts/player_camera.gd" id="3_y4i8p"]
[ext_resource type="PackedScene" uid="uid://s4oqqr201p7v" path="res://Scenes/user_interface.tscn" id="4_nljwa"]
[ext_resource type="PackedScene" uid="uid://bxs8fdaw2blq0" path="res://Scenes/conveyor_belt.tscn" id="5_dcnt0"]

[sub_resource type="GDScript" id="GDScript_ud5np"]
script/source = "extends Node

signal present_despawned

@export var max_present_on_screen_count: int = 2
@export var present_scene: PackedScene
@export var default_present_spawn_pos: Vector3

var present_spawn_pos: Vector3


func _ready():
	reset_global_variables()


func _process(_delta):
	# Restart Scene
	if Input.is_key_pressed(KEY_ENTER):
		get_tree().reload_current_scene()
	
	# Control present spawning
	if GlobalVariables.present_on_screen_count < max_present_on_screen_count:
		var present = present_scene.instantiate()
		# Offset the presents' spawning position
		present_spawn_pos.x = default_present_spawn_pos.x - (10 * GlobalVariables.present_on_screen_count)
		present.initialise(present_spawn_pos)
		instantiate_object(present)
		GlobalVariables.present_on_screen_count += 1


func instantiate_object(present):
	add_child(present, true)


func reset_global_variables():
	GlobalVariables.inspection_in_progress = false
	GlobalVariables.present_on_screen_count = 1


func _on_level_timer_timeout():
	get_tree().reload_current_scene()
"

[node name="Main" type="Node"]
script = SubResource("GDScript_ud5np")
present_scene = ExtResource("1_mb113")
default_present_spawn_pos = Vector3(-10, 0, 0)

[node name="Player" parent="." instance=ExtResource("2_uywyi")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 5.46527)

[node name="PlayerCamera" type="Camera3D" parent="Player"]
script = ExtResource("3_y4i8p")

[node name="Present" parent="." instance=ExtResource("1_mb113")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -10, 0, 0)

[node name="UserInterface" parent="." instance=ExtResource("4_nljwa")]

[node name="LevelTimer" type="Timer" parent="."]
wait_time = 60.0
one_shot = true
autostart = true

[node name="Conveyor belt" parent="." instance=ExtResource("5_dcnt0")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0119486, -0.726182, 3.04168)

[connection signal="present_despawned" from="." to="." method="_on_present_despawned"]
[connection signal="inspection_exited" from="Present" to="." method="_on_present_inspection_exited"]
[connection signal="tree_exited" from="Present" to="." method="_on_present_tree_exited"]
[connection signal="timeout" from="LevelTimer" to="." method="_on_level_timer_timeout"]
